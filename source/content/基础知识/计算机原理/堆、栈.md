

### 一、预备知识—程序的内存分配

一个由c/C++编译的程序占用的内存分为以下几个部分：

### 1. 栈区（stack）

栈区由编译器自动分配和释放，存放函数的参数值，局部变量的值等。操作方式类似于数据结构中的栈。这样的分配方式效率非常高，因为计算机在底层对栈的支持是直接的，执行push和pop操作非常快。

### 2. 堆区（heap）

堆区由程序员分配和释放，分配方式类似于链表。如果程序员不释放，程序结束时可能由OS回收。由于堆区的分配需要时间查找可用空间，所以速度较慢。

### 3. 全局区（静态区）（static）

存储全局变量和静态变量，程序结束后由系统释放。静态或全局变量的生命周期贯穿整个程序运行期间。

### 4. 文字常量区

常量字符串就是放在这里的。程序结束后由系统释放。

### 5. 程序代码区

存放函数体的二进制代码。

### 二、堆和栈的理论知识

### 2.1 申请方式

- **栈（stack）**:
系统自动分配，例如局部变量的定义 `int b;`，效率非常高。
- **堆（heap）**:
需要手动申请，并指明大小。在Python中，所有对象都存放在堆中，例如：
这里arr本身存放在栈上，指向一个堆中的数组对象。
    
    ```python
    arr = [1, 2, 3]
    ```
    

### 2.2 申请后系统的响应

- **栈**：如果栈剩余空间大于申请空间，系统会提供内存，否则报异常提示栈溢出。
- **堆**：系统会遍历空闲链表，找到合适的空间分配给程序。多余的部分会重新放入空闲链表。

### 2.3 申请大小的限制

- **栈**：限制较小，如2M，超出空间会溢出。
- **堆**：大小受限于有效的虚拟内存，相对灵活且较大。

### 2.4 申请效率的比较

- **栈**：由系统自动分配，速度快，但无法控制🚀。
- **堆**：一般速度较慢，容易产生内存碎片，但使用最方便🐢。

### 2.5 堆和栈中的存储内容

- **栈**：存放函数调用时的参数和局部变量等。
- **堆**：一般存放动态分配的数据，程序员控制。

### 2.6 存取效率的比较

栈上的数据存取速度快，因为地址是连续的。堆上的数据存取速度相对慢，因为地址可能是不连续的。

### 2.7 小结

- 使用栈像是去饭馆吃饭，快捷但自由度小🍴。
- 使用堆就像自己做饭，麻烦但自由度大🍳。