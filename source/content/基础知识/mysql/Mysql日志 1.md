
## **MySQL的redo日志**

用于系统故障发生后的崩溃恢复。

修改数据时，会先修改内存的page，然后才同步到磁盘，如果在此期间发生异常，就恢复不了了，所以修改内存page后会写redo log（顺序写入，所以很快，对性能影响较小）

当数据库意外重启时，会根据 redo log 进行数据恢复，如果 redo log 中有事务提交，则进行事务提交修改数据。

## **MySQL的undo日志**

用于故障恢复，方便执行撤销操作。

与 redo log 不同，undo log 一般是逻辑日志，根据每行记录进行记录。例如当 DELETE 一条记录时，undo log 中会记录一条对应的 INSERT 记录，反之亦然当 UPDTAE 一条记录时，它记录一条对应反向 UPDATE 记录。

通过 undo log 一方面可以实现事务回滚，另一方面可以根据 undo log 回溯到某个特定的版本的数据，InnoDB实现 MVCC 的功能时就会用到undo log。

<aside>
✅ 回滚段

在数据库领域，"回滚段"（Rollback Segment）这个名词常用于Oracle等数据库系统中，而不是MySQL的InnoDB。下面我会从一般的数据库角度以及Oracle的实现来具体描述回滚段的功能。

### 回滚段的作用

1. **事务回滚**: 回滚段用于存储事务中改变的数据的旧版本。如果一个事务未能成功地提交，那么可以使用回滚段中的数据来撤销这个事务的所有改变。
2. **一致性读**: 在一个事务正在对数据进行改变的同时，其他事务可能需要读取这个数据。这种情况下，其他事务可以读取存储在回滚段中的数据的旧版本，以保证读取的数据的一致性。
3. **并发控制**: 回滚段也是多版本并发控制（MVCC）实现的一部分，通过提供数据的不同版本来支持多个事务并发执行。

### 回滚段的组成

1. **回滚块**: 回滚段由一系列回滚块（Rollback Blocks）组成，每个回滚块用于存储一个或多个事务改变的数据的旧版本。
2. **回滚段头**: 包含管理信息，用于追踪各个回滚块和与其关联的事务。

### 实际运作

1. **开始事务**: 当一个事务开始并对数据进行改变时（如INSERT, UPDATE, DELETE等），旧的数据版本会被保存到回滚段。
2. **事务操作**: 在事务进行的过程中，如果更多的数据被改变，更多的旧版本数据会被保存到回滚段。
3. **事务提交或回滚**: 如果事务成功提交，回滚段中对应的数据通常会被标记为可回收，以便之后被重用。如果事务需要回滚，那么系统会使用回滚段中的旧版本数据来撤销所有改变。
4. **垃圾回收**: 当旧版本数据不再需要用于事务回滚或一致性读取时，它们会被从回滚段中删除或回收。

这就是回滚段的基础概念和功能。需要注意的是，不同的数据库系统可能有不同的实现细节。例如，在Oracle中，这些功能通常通过回滚段来实现；而在MySQL的InnoDB引擎中，相应的功能是通过Undo日志来实现的。

</aside>

## **Mysql的二进制日志:主要用来主从复制**

记录了所有对mysql的修改的时间(执行失败和回滚不生成日志)

binlog可以查看

格式：

**基于段的格式  binlog_format=STATEMENT:记录sql**

**基于段的格式  binlog_format=ROW：记录数据的更改(更安全，可恢复数据)**

**混合日志格式  binlog_fo,rmat=MIXED:记录sql**

数据库语句

:set session binlog_format=row:设置二进制日志的格式

show variables like ‘binlog_format’:查看二进制日志格式

:show binary logs:查看当前日志文件

flush logs:会生出新的log文件

mysqlbinlog   日志文件名  :查看日志文件内容

binlog_row_image:修改row格式日志写入模式