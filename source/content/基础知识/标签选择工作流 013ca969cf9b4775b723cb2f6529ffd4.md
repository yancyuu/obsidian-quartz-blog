# 标签选择工作流

Owner: yancy yu

```jsx
app:
  description: "feat(\u8BC4\u8BBA): \u589E\u52A0\u8BC4\u8BBA\u6807\u7B7E\u9009\u62E9\
    \u7684\u529F\u80FD\n\n\u5B9E\u73B0\u7528\u6237\u9009\u62E9\u7279\u5B9A\u8BC4\u8BBA\
    \u6807\u7B7E\u7684\u529F\u80FD"
  icon: "\U0001F51B"
  icon_background: '#FFE4E8'
  mode: workflow
  name: "\u6807\u7B7E\u9009\u62E9\u5668\u5DE5\u4F5C\u6D41\u3010\u7EBF\u4E0A\u3011"
workflow:
  features:
    file_upload:
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
    opening_statement: ''
    retriever_resource:
      enabled: true
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        isInIteration: false
        sourceType: start
        targetType: code
      id: 1719806031072-source-1719806045322-target
      source: '1719806031072'
      sourceHandle: source
      target: '1719806045322'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: code
        targetType: if-else
      id: 1719806045322-source-1719806246182-target
      source: '1719806045322'
      sourceHandle: source
      target: '1719806246182'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: if-else
        targetType: llm
      id: 1719806246182-true-1719806258768-target
      source: '1719806246182'
      sourceHandle: 'true'
      target: '1719806258768'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: llm
        targetType: code
      id: 1719806258768-source-1719806494827-target
      source: '1719806258768'
      sourceHandle: source
      target: '1719806494827'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: code
        targetType: end
      id: 1719806494827-source-1719806445056-target
      source: '1719806494827'
      sourceHandle: source
      target: '1719806445056'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: if-else
        targetType: llm
      id: 1719806246182-false-1719806881682-target
      source: '1719806246182'
      sourceHandle: 'false'
      target: '1719806881682'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: llm
        targetType: code
      id: 1719806881682-source-1719812840178-target
      source: '1719806881682'
      sourceHandle: source
      target: '1719812840178'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        sourceType: code
        targetType: end
      id: 1719812840178-source-1719813000907-target
      source: '1719812840178'
      sourceHandle: source
      target: '1719813000907'
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        desc: ''
        selected: false
        title: "\u5F00\u59CB"
        type: start
        variables:
        - label: delimiter
          max_length: null
          options: []
          required: true
          type: text-input
          variable: delimiter
        - label: comments
          max_length: null
          options: []
          required: true
          type: paragraph
          variable: comments
        - label: keyword_dimension
          max_length: null
          options: []
          required: true
          type: paragraph
          variable: keyword_dimension
      height: 142
      id: '1719806031072'
      position:
        x: 80
        y: 282
      positionAbsolute:
        x: 80
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "\ndef main(delimiter: str, comments: str) -> dict:\n    comments =\
          \ comments.split(delimiter)\n    return {\n        \"comment_length\": len(comments)\n\
          \    }\n"
        code_language: python3
        desc: ''
        outputs:
          comment_length:
            children: null
            type: number
        selected: false
        title: "\u89E3\u6790\u8BC4\u8BBA\u6761\u6570"
        type: code
        variables:
        - value_selector:
          - '1719806031072'
          - delimiter
          variable: delimiter
        - value_selector:
          - '1719806031072'
          - comments
          variable: comments
      height: 54
      id: '1719806045322'
      position:
        x: 343
        y: 282
      positionAbsolute:
        x: 343
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        conditions:
        - comparison_operator: '>'
          id: '1719806247844'
          value: '1'
          variable_selector:
          - '1719806045322'
          - comment_length
        desc: ''
        logical_operator: and
        selected: false
        title: "\u6761\u4EF6\u5206\u652F"
        type: if-else
      height: 126
      id: '1719806246182'
      position:
        x: 647
        y: 282
      positionAbsolute:
        x: 647
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: "\u6761\u6570\u5927\u4E8E1\u6761\u4E3A\u6279\u91CF\u9009\u62E9\u6807\
          \u7B7E\uFF0C\u53EF\u4EE5\u6709\u6548\u8282\u7EA6\u65F6\u95F4\u548C\u6210\
          \u672C\uFF0C\u76EE\u524D\u6D4B\u8BD5\u53EA\u6709GPT4\u53EF\u4EE5\u5B8C\u6210\
          \u8FD9\u4E2A\u590D\u6742\u7684\u4EFB\u52A1\u3002"
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: skgit4o
          provider: azure_openai
        prompt_template:
        - id: 09dc855c-7abc-4d27-8d8b-5dda6f43bf42
          role: system
          text: "## Global\n\u76EE\u6807\uFF1A \u6839\u636E\u9884\u8BBE\u7684\u7EF4\
            \u5EA6\u5206\u6790\u6240\u8F93\u5165\u7684{{#1719806045322.comment_length#}}\u6761\
            \u8BC4\u8BBA\u7684\u60C5\u611F\u3002\u6587\u672C\u4E2D\u63D0\u53CA\u7684\
            \u6BCF\u4E2A\u7EF4\u5EA6\u5E94\u6839\u636E\u5176\u60C5\u611F\u503E\u5411\
            \u8FDB\u884C\u8BC4\u4F30\u6B63\u8D1F\u9762(\u6B63\u9762(1)\u3001\u8D1F\
            \u9762(-1)\u6216\u4E2D\u6027(0))\u548C\u5173\u6CE8\u70B9\u5206\u6790\u3002\
            \u53EA\u5E94\u8003\u8651\u201CKeywordDimension\u201D\u679A\u4E3E\u4E2D\
            \u5217\u51FA\u7684\u7EF4\u5EA6\uFF0C\u4E0D\u8981\u6F0F\u6389\u4EFB\u4F55\
            \u4E00\u6761\u8BC4\u8BBA\uFF0C\u4E0D\u8981\u5C06\u91CD\u590D\u8BC4\u8BBA\
            \u5408\u5E76\uFF0C\u4E25\u683C\u6309\u7167\u3010Instructions\u3011\u6267\
            \u884C\u5206\u6790\uFF0C\u5E76\u4E14\u6309\u7167\u3010OutputFormat\u3011\
            \u8F93\u51FA\u5206\u6790\u7ED3\u679C\u3002\n\n\n\n## Instructions\n- \u4ED4\
            \u7EC6\u9605\u8BFB\u8F93\u5165\u6587\u672C\u4E2D\u7684{{#1719806045322.comment_length#}}\u6761\
            \u8BC4\u8BBA\uFF08{{#1719806031072.delimiter#}}\u5206\u9694\uFF09\uFF0C\
            \u786E\u5B9A\u6BCF\u6761\u8BC4\u8BBA\u4E2D\u63D0\u53CA\u5230\u7684\u9884\
            \u8BBE\u7EF4\u5EA6\u3002\n\n\n- \u5BF9\u4E8E\u5355\u6761\u8BC4\u8BBA\uFF0C\
            \u7528\u786E\u5B9A\u7684\u9884\u8BBE\u7EF4\u5EA6\uFF0C\u5206\u6790\u4E0A\
            \u4E0B\u6587\u4EE5\u5224\u65AD\u60C5\u611F\u53CA\u5BF9\u5E94\u7EF4\u5EA6\
            \u7684\u7528\u6237\u5173\u6CE8\u70B9\uFF1A\n\u6B63\u9762\u60C5\u611F(1)\uFF1A\
            \u4EE5\u79EF\u6781\u6216\u6B63\u9762\u7684\u65B9\u5F0F\u8BA8\u8BBA\u7EF4\
            \u5EA6\u3002\n\u8D1F\u9762\u60C5\u611F(-1)\uFF1A\u4EE5\u4E0D\u5229\u6216\
            \u6279\u8BC4\u7684\u65B9\u5F0F\u63D0\u53CA\u7EF4\u5EA6\u3002\n\u4E2D\u6027\
            \u60C5\u611F(0)\uFF1A\u8BA8\u8BBA\u7EF4\u5EA6\u7684\u65B9\u5F0F\u4E2D\u7ACB\
            \uFF0C\u6CA1\u6709\u660E\u786E\u7684\u6B63\u9762\u6216\u8D1F\u9762\u542B\
            \u4E49\u3002\n- \u5982\u679C\u5355\u6761\u8BC4\u8BBA\u4E2D\u6CA1\u6709\
            \u63D0\u53CA\u9884\u8BBE\u7EF4\u5EA6\uFF0C\u5219\u4E0D\u5E94\u5305\u62EC\
            \u5728\u8F93\u51FA\u4E2D\u3002\n- \u6BCF\u4E00\u4E2A\u9884\u8BBE\u7EAC\
            \u5EA6\u5BF9\u4E8E\u540C\u4E00\u6761\u8BC4\u8BBA\u53EA\u80FD\u88AB\u9009\
            \u62E9\u4E00\u6B21\u3002\n- \u4E8C\u6B21\u68C0\u67E5\uFF0C\u786E\u4FDD\
            \u4EE5\u4E0B\u51E0\u70B9\uFF1A\n1.\u4E0D\u8981\u6F0F\u6389/\u65B0\u589E\
            \u4EFB\u4F55\u4E00\u6761\u8BC4\u8BBA\uFF0C\u4E0D\u8981\u6539\u53D8\u8BC4\
            \u8BBA\u987A\u5E8F;\n2.\u8F93\u51FA\u7EF4\u5EA6\u4E00\u5B9A\u8981\u5728\
            \u9884\u8BBE\u7EAC\u5EA6\u4E2D\uFF0C\u6CA1\u6709\u627E\u5230\u4EFB\u4F55\
            \u7EF4\u5EA6\u7684\u8BC4\u8BBA\u76F4\u63A5\u6362\u884C\u8FDB\u884C\u4E0B\
            \u4E00\u4E2A\u8BC4\u8BBA\u5339\u914D\u3002\n3. \u4FDD\u8BC1\u8F93\u51FA\
            \u4E00\u5B9A\u4E3A{{#1719806045322.comment_length#}}\u6761\u3002\n\n\n\
            4.\u8F93\u51FA\u683C\u5F0F\u4E25\u683C\u6309\u7167{OutputFormat}\u8F93\
            \u51FA\uFF0C\u4E14\u8F93\u51FA\u987A\u5E8F\u4E00\u5B9A\u8981\u548C\u8F93\
            \u5165\u7684\u8BC4\u8BBA\u4E00\u81F4\u3002\n5.\u7528\u6237\u5173\u6CE8\
            \u70B9\u4E00\u5B9A\u8981\u548C\u7EF4\u5EA6\u76F8\u5BF9\u5E94\uFF0C\u4E0D\
            \u540C\u5173\u6CE8\u70B9\u8981\u6709\u533A\u5206\u5EA6\uFF0C\u4E0D\u540C\
            \u7EF4\u5EA6\u4E0D\u8981\u5408\u5E76\uFF0C\u76F8\u540C\u7EF4\u5EA6\u4E0B\
            \u7684\u5173\u6CE8\u70B9\u9700\u8981\u5408\u5E76\uFF0C\u7528\u9017\u53F7\
            \u5206\u9694\uFF0C\u5173\u6CE8\u70B9\u5C3D\u53EF\u80FD\u6709\u5DEE\u5F02\
            \uFF0C\u4E14\u957F\u5EA6\u4E0D\u8981\u8D85\u8FC715\u4E2A\u5B57\u3002\n\
            \n## KeywordDimension\u9884\u8BBE\u7EF4\u5EA6\u53CA\u5176\u8BF4\u660E\uFF1A\
            \n{{#1719806031072.keyword_dimension#}}\n\n## OutputFormat\n\u8F93\u51FA\
            \u6210python\u53EF\u4EE5\u89E3\u6790\u7684json\u5B57\u7B26\u4E32\uFF1A\
            \u4E0D\u540C\u8BC4\u8BBA\u5BF9\u5E94\u7684\u8F93\u51FA\u4E00\u5B9A\u8981\
            \u7528\u5217\u8868\u5206\u9694\uFF0C\u5E76\u4E14\u6309\u7167\u8F93\u5165\
            \u987A\u5E8F\u6392\u5E8F\uFF0C\u4EE5\u514D\u6DF7\u6DC6\uFF0C\u4EE5\u4EE5\
            \u4E0B\u683C\u5F0F\u63D0\u4F9B\u60C5\u611F\u5206\u6790\u7ED3\u679C\uFF1A\
            \n[[{name: <\u8F93\u5165\u8BC4\u8BBA1\u7684\u7EF4\u5EA61>,\nattention:<\u8F93\
            \u51651\u6B64\u7EAC\u5EA6\u7684\u5173\u6CE8\u70B9>,\nscore:<\u8F93\u5165\
            1\u6B64\u7EAC\u5EA6\u60C5\u611FN>,}......{name: <\u8F93\u5165\u8BC4\u8BBA\
            1\u7684\u7EF4\u5EA61>,attention:<\u8F93\u51651\u6B64\u7EAC\u5EA6\u7684\
            \u5173\u6CE8\u70B9>,score:<\u8F93\u51651\u6B64\u7EAC\u5EA6\u60C5\u611F\
            N>,}],......[{name: <\u8F93\u5165\u8BC4\u8BBAN\u7684\u7EF4\u5EA61>,attention:<\u8F93\
            \u51651\u6B64\u7EAC\u5EA6\u7684\u5173\u6CE8\u70B9>,score:<\u8F93\u5165\
            1\u6B64\u7EAC\u5EA6\u60C5\u611FN>,}......{name: <\u8F93\u5165\u8BC4\u8BBA\
            N\u7684\u7EF4\u5EA6N>,attention:<\u8F93\u51651\u6B64\u7EAC\u5EA6\u7684\
            \u5173\u6CE8\u70B9>,score:<\u8F93\u51651\u6B64\u7EAC\u5EA6\u60C5\u611F\
            N>}]]\n\n\u786E\u4FDD\u8F93\u51FA\u4E2D\u63D0\u53CA\u7684\u6BCF\u4E2A\u7EF4\
            \u5EA6\u90FD\u662F\u201CKeywordDimension\u201D\u679A\u4E3E\u7684\u4E00\
            \u90E8\u5206,\u4E14\u5916\u5C42\u5217\u8868\u6570\u91CF\u548C\u8F93\u5165\
            \u8BC4\u4EF7\u7684\u6570\u91CF\u4E00\u81F4\u3002\n\n# Example\uFF1A\n\u793A\
            \u4F8B\u8F93\u5165\uFF1A \n\"\u6211\u89C9\u5F97\u8FD9\u4E2A\u4EA7\u54C1\
            \u7684\u5305\u88C5\u975E\u5E38\u4EBA\u6027\u5316\u548C\u65F6\u5C1A\uFF0C\
            \u4F46\u7EA2\u8272\u770B\u8D77\u6765\u4E0D\u592A\u5438\u5F15\u4EBA\uFF0C\
            \u4F53\u9A8C\u8FD8\u53EF\u4EE5\u3002{{#1719806031072.delimiter#}}\u4E0D\
            \u597D\u7528\u3002\"\n\n\u793A\u4F8B\u9884\u8BBE\u7EF4\u5EA6\uFF1A\n{\n\
            \"\u5305\u88C5\u8BBE\u8BA1\": \"\u5BF9\u5305\u88C5\u7F8E\u89C2\u7684\u8BC4\
            \u4EF7\",\n\"\u989C\u8272\u5438\u5F15\u529B\": \"\u5BF9\u989C\u8272\u5438\
            \u5F15\u529B\u7684\u8BC4\u4EF7\",\n\"\u6574\u4F53\u4F53\u9A8C\": \"\u5BF9\
            \u4EA7\u54C1\u6574\u4F53\u4F53\u9A8C\u7684\u8BC4\u4EF7\"\n}\n\n\u793A\u4F8B\
            \u8F93\u51FA\uFF1A\n[[{\"name\": \"\"\u5305\u88C5\u8BBE\u8BA1\",\"attention\"\
            : \"\u4EBA\u6027\u5316,\u65F6\u5C1A\",\"score\":1},\"name\": \"\"\u989C\
            \u8272\u5438\u5F15\u529B\",\"attention\":\"\u7EA2\u8272\u4E0D\u5438\u5F15\
            \u4EBA\",\"score\":-1},{\"name\": \"\u6574\u4F53\u4F53\u9A8C\",\"attention\"\
            :\"\u4F53\u9A8C\u8FD8\u884C\",\"score\":1}],[{\"name\": \"\u6574\u4F53\
            \u4F53\u9A8C\",\"attention\": \"\u4E0D\u597D\u7528\",\"score\": -1}]]\n\
            \n\u793A\u4F8B2\uFF1A\n\u8F93\u5165\uFF1A \"\u4EA7\u54C1\u7684\u5C3A\u5BF8\
            \u5B8C\u7F8E\u7B26\u5408\u6211\u7684\u9700\u6C42\uFF0C\u989C\u8272\u4E5F\
            \u597D\u770B\u3002\"\n\u9884\u8BBE\u7EF4\u5EA6\uFF1A\n{\n\"\u5C3A\u5BF8\
            \u9002\u914D\": \"\u5BF9\u4EA7\u54C1\u5C3A\u5BF8\u9002\u914D\u6027\u7684\
            \u8BC4\u4EF7\",\n}\n\u8F93\u51FA:\n[[{\"name\":\"\u5C3A\u5BF8\u9002\u914D\
            \"\"attention\":\"\u5C3A\u5BF8\u5B8C\u7F8E\",\"score\":1}]]\n\u6CE8\u610F\
            \uFF1A \u4EC5\u4E13\u6CE8\u4E8E\u9884\u8BBE\u7684\u7EF4\u5EA6\u3002\u5FFD\
            \u7565\u679A\u4E3E\u4E2D\u672A\u5217\u51FA\u7684\u4EFB\u4F55\u7EF4\u5EA6\
            \uFF0C\u5E76\u786E\u4FDD\u6240\u6709\u8BC4\u4F30\u90FD\u57FA\u4E8E\u8F93\
            \u5165\u6587\u672C\u4E2D\u63D0\u4F9B\u7684\u4E0A\u4E0B\u6587\u3002\n\n\
            # Init:\n\u8BF7\u8F93\u5165\u591A\u6761\u8BC4\u8BBA\uFF0C\u6211\u4F1A\u6309\
            \u7167Global\u6267\u884C\u540E\u8F93\u51FA\u5206\u6790\u7ED3\u679C\u3002\
            \n"
        - id: 7ca01b57-7f30-49f7-a285-eaa08b8710af
          role: user
          text: '{{#1719806031072.comments#}}'
        selected: false
        title: "\u6279\u91CF\u6807\u7B7E\u9009\u62E9\u5668"
        type: llm
        variables: []
        vision:
          configs:
            detail: high
          enabled: true
      height: 164
      id: '1719806258768'
      position:
        x: 911
        y: 196
      positionAbsolute:
        x: 911
        y: 196
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        outputs:
        - value_selector:
          - '1719806494827'
          - target_labels
          variable: content
        selected: false
        title: "\u6279\u91CF\u9009\u62E9\u7ED3\u675F"
        type: end
      height: 90
      id: '1719806445056'
      position:
        x: 1627
        y: 196
      positionAbsolute:
        x: 1627
        y: 196
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "import json\nimport re\n\ndef preprocess_text(text):\n    # \u5C1D\u8BD5\
          \u53BB\u9664Markdown\u4EE3\u7801\u5757\u6807\u8BB0\uFF0C\u5982\u679C\u5B58\
          \u5728\n    cleaned_text = re.sub(r'```json\\n?', '', text)\n    cleaned_text\
          \ = re.sub(r'\\n?```', '', cleaned_text)\n    # \u53BB\u9664\u989D\u5916\
          \u7684\u7A7A\u767D\u5B57\u7B26\n    cleaned_text = re.sub(r'\\s+', ' ',\
          \ cleaned_text).strip()\n    return cleaned_text\n\ndef extract_json(cleaned_text):\n\
          \    # \u5C1D\u8BD5\u89E3\u6790\u6574\u4E2A\u6587\u672C\u4E3AJSON\n    try:\n\
          \        json_data = json.loads(cleaned_text)\n        return json_data\n\
          \    except json.JSONDecodeError:\n        # \u5982\u679C\u76F4\u63A5\u89E3\
          \u6790\u5931\u8D25\uFF0C\u5C1D\u8BD5\u67E5\u627E\u6240\u6709\u53EF\u80FD\
          \u7684JSON\u5BF9\u8C61\u6216\u6570\u7EC4\n        pattern = r'(\\[.*?\\\
          ])'\n        matches = re.findall(pattern, cleaned_text, re.DOTALL)\n  \
          \      return json.loads(matches[-1])\n\ndef main(keyword_dimension: str,\
          \ text: str) -> dict:\n    all_target_labels = []\n    predefined_labels\
          \ = json.loads(keyword_dimension)\n    cleaned_text = preprocess_text(text)\n\
          \    print(f\"cleaned_text {cleaned_text}\")\n    tags_arr = extract_json(cleaned_text)\n\
          \    print(f\"json_data {tags_arr}\")\n    print(f\"type {type(tags_arr)}\"\
          )\n\n    for sublist in tags_arr:\n        target_labels = []\n        for\
          \ tag in sublist:\n            if not isinstance(tag, dict):\n         \
          \       raise ValueError(\"Each tag in tags list is not a dict\")\n    \
          \        if tag.get(\"name\") in predefined_labels:\n                target_labels.append({\n\
          \                    \"name\": tag.get(\"name\"),\n                    \"\
          attention\": tag.get(\"attention\"),\n                    \"score\": int(tag.get(\"\
          score\"))\n                })\n        if target_labels:\n            all_target_labels.append(target_labels)\n\
          \n    # \u8F6C\u6362\u6210\u591A\u7EF4\u6570\u7EC4\n    return {\n     \
          \   \"target_labels\": json.dumps(all_target_labels, ensure_ascii=False)\n\
          \    }"
        code_language: python3
        desc: ''
        outputs:
          target_labels:
            children: null
            type: string
        selected: false
        title: "\u89E3\u6790\u6A21\u578B\u7684json\u7ED3\u679C"
        type: code
        variables:
        - value_selector:
          - '1719806031072'
          - keyword_dimension
          variable: keyword_dimension
        - value_selector:
          - '1719806258768'
          - text
          variable: text
      height: 54
      id: '1719806494827'
      position:
        x: 1326
        y: 196
      positionAbsolute:
        x: 1326
        y: 196
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        context:
          enabled: false
          variable_selector: []
        desc: "\u5355\u6761\u8BC4\u8BBA\u6807\u7B7E\u9009\u62E9\u5668\uFF0C\u65B9\u4FBF\
          \u4F7F\u7528\uFF0C\u6A21\u578B\u80FD\u529B\u9700\u8981>=GPT\n3.5.\u76EE\u524D\
          \u6D4B\u8BD5\u6210\u672C\u6700\u4F4E\u7684\u6A21\u578B\u662Fdoubao-pro-32k"
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: Doubao-pro-32k
          provider: volcengine_maas
        prompt_template:
        - id: 06ca84f9-1cc1-48f9-893b-a1c8cd13a6e7
          role: system
          text: "## Global\n\u76EE\u6807\uFF1A \u6839\u636E\u9884\u8BBE\u7684\u7EF4\
            \u5EA6\u5206\u6790\u6240\u8F93\u5165\u8BC4\u8BBA\u7684\u60C5\u611F\u3002\
            \u6587\u672C\u4E2D\u63D0\u53CA\u7684\u6BCF\u4E2A\u7EF4\u5EA6\u5E94\u6839\
            \u636E\u5176\u60C5\u611F\u503E\u5411\u8FDB\u884C\u8BC4\u4F30\u6B63\u8D1F\
            \u9762(\u6B63\u9762(1)\u3001\u8D1F\u9762(-1)\u6216\u4E2D\u6027(0))\u548C\
            \u5173\u6CE8\u70B9\u5206\u6790\u3002\u53EA\u5E94\u8003\u8651\u201CKeywordDimension\u201D\
            \u679A\u4E3E\u4E2D\u5217\u51FA\u7684\u7EF4\u5EA6\uFF0C\u4E0D\u8981\u6F0F\
            \u6389\u4EFB\u4F55\u4E00\u6761\u8BC4\u8BBA\uFF0C\u4E0D\u8981\u5C06\u91CD\
            \u590D\u8BC4\u8BBA\u5408\u5E76\uFF0C\u4E25\u683C\u6309\u7167\u3010Instructions\u3011\
            \u6267\u884C\u5206\u6790\uFF0C\u5E76\u4E14\u6309\u7167\u3010OutputFormat\u3011\
            \u8F93\u51FA\u5206\u6790\u7ED3\u679C\u3002\n\n## Instructions\n- \u5BF9\
            \u4E8E\u5355\u6761\u8BC4\u8BBA\uFF0C\u7528\u786E\u5B9A\u7684\u9884\u8BBE\
            \u7EF4\u5EA6\uFF0C\u5206\u6790\u4E0A\u4E0B\u6587\u4EE5\u5224\u65AD\u60C5\
            \u611F\u53CA\u5BF9\u5E94\u7EF4\u5EA6\u7684\u7528\u6237\u5173\u6CE8\u70B9\
            \uFF1A\n\u6B63\u9762\u60C5\u611F(1)\uFF1A\u4EE5\u79EF\u6781\u6216\u6B63\
            \u9762\u7684\u65B9\u5F0F\u8BA8\u8BBA\u7EF4\u5EA6\u3002\n\u8D1F\u9762\u60C5\
            \u611F(-1)\uFF1A\u4EE5\u4E0D\u5229\u6216\u6279\u8BC4\u7684\u65B9\u5F0F\
            \u63D0\u53CA\u7EF4\u5EA6\u3002\n\u4E2D\u6027\u60C5\u611F(0)\uFF1A\u8BA8\
            \u8BBA\u7EF4\u5EA6\u7684\u65B9\u5F0F\u4E2D\u7ACB\uFF0C\u6CA1\u6709\u660E\
            \u786E\u7684\u6B63\u9762\u6216\u8D1F\u9762\u542B\u4E49\u3002\n- \u5982\
            \u679C\u5355\u6761\u8BC4\u8BBA\u4E2D\u6CA1\u6709\u63D0\u53CA\u9884\u8BBE\
            \u7EF4\u5EA6\uFF0C\u5219\u4E0D\u5E94\u5305\u62EC\u5728\u8F93\u51FA\u4E2D\
            \u3002\n- \u6BCF\u4E00\u4E2A\u9884\u8BBE\u7EAC\u5EA6\u5BF9\u4E8E\u540C\
            \u4E00\u6761\u8BC4\u8BBA\u53EA\u80FD\u88AB\u9009\u62E9\u4E00\u6B21\u3002\
            \n- \u4E8C\u6B21\u68C0\u67E5\uFF0C\u786E\u4FDD\u4EE5\u4E0B\u51E0\u70B9\
            \uFF1A\n1.\u4E0D\u8981\u6F0F\u6389/\u65B0\u589E\u4EFB\u4F55\u4E00\u6761\
            \u8BC4\u8BBA\uFF0C\u4E0D\u8981\u6539\u53D8\u8BC4\u8BBA\u987A\u5E8F;\n\
            2.\u8F93\u51FA\u7EF4\u5EA6\u4E00\u5B9A\u8981\u5728\u9884\u8BBE\u7EAC\u5EA6\
            \u4E2D\uFF0C\u6CA1\u6709\u627E\u5230\u4EFB\u4F55\u7EF4\u5EA6\u7684\u8BC4\
            \u8BBA\u76F4\u63A5\u6362\u884C\u8FDB\u884C\u4E0B\u4E00\u4E2A\u8BC4\u8BBA\
            \u5339\u914D\u3002\n3.\u8F93\u51FA\u683C\u5F0F\u4E25\u683C\u6309\u7167\
            {OutputFormat}\u8F93\u51FA\uFF0C\u4E14\u8F93\u51FA\u987A\u5E8F\u4E00\u5B9A\
            \u8981\u548C\u8F93\u5165\u7684\u8BC4\u8BBA\u4E00\u81F4\u3002\n4.\u7528\
            \u6237\u5173\u6CE8\u70B9\u4E00\u5B9A\u8981\u548C\u7EF4\u5EA6\u76F8\u5BF9\
            \u5E94\uFF0C\u4E0D\u540C\u5173\u6CE8\u70B9\u8981\u6709\u533A\u5206\u5EA6\
            \uFF0C\u4E0D\u540C\u7EF4\u5EA6\u4E0D\u8981\u5408\u5E76\uFF0C\u76F8\u540C\
            \u7EF4\u5EA6\u4E0B\u7684\u5173\u6CE8\u70B9\u9700\u8981\u5408\u5E76\uFF0C\
            \u7528\u9017\u53F7\u5206\u9694\uFF0C\u5173\u6CE8\u70B9\u5C3D\u53EF\u80FD\
            \u6709\u5DEE\u5F02\uFF0C\u4E14\u957F\u5EA6\u4E0D\u8981\u8D85\u8FC715\u4E2A\
            \u5B57\u3002\n\n## KeywordDimension\u9884\u8BBE\u7EF4\u5EA6\u53CA\u5176\
            \u8BF4\u660E\uFF1A\n{{#1719806031072.keyword_dimension#}}\n\n## OutputFormat\n\
            \u8F93\u51FA\u6210python\u53EF\u4EE5\u89E3\u6790\u7684json\u5B57\u7B26\
            \u4E32,\u4EE5\u4EE5\u4E0B\u683C\u5F0F\u63D0\u4F9B\u60C5\u611F\u5206\u6790\
            \u7ED3\u679C\uFF1A\n\n[{name: <\u8F93\u5165\u8BC4\u8BBA1\u7684\u7EF4\u5EA6\
            1>,\nattention:<\u8F93\u51651\u6B64\u7EAC\u5EA6\u7684\u5173\u6CE8\u70B9\
            >,\nscore:<\u8F93\u51651\u6B64\u7EAC\u5EA6\u60C5\u611FN>,}...]]\n\n# Example\uFF1A\
            \n\u793A\u4F8B\u8F93\u5165\uFF1A \n\"\u6211\u89C9\u5F97\u8FD9\u4E2A\u4EA7\
            \u54C1\u7684\u5305\u88C5\u975E\u5E38\u4EBA\u6027\u5316\u548C\u65F6\u5C1A\
            \uFF0C\u4F46\u7EA2\u8272\u770B\u8D77\u6765\u4E0D\u592A\u5438\u5F15\u4EBA\
            \uFF0C\u4F53\u9A8C\u8FD8\u53EF\u4EE5\u3002\"\n\u793A\u4F8B\u9884\u8BBE\
            \u7EF4\u5EA6\uFF1A\n{\n\"\u5305\u88C5\u8BBE\u8BA1\": \"\u5BF9\u5305\u88C5\
            \u7F8E\u89C2\u7684\u8BC4\u4EF7\",\n\"\u989C\u8272\u5438\u5F15\u529B\"\
            : \"\u5BF9\u989C\u8272\u5438\u5F15\u529B\u7684\u8BC4\u4EF7\",\n\"\u6574\
            \u4F53\u4F53\u9A8C\": \"\u5BF9\u4EA7\u54C1\u6574\u4F53\u4F53\u9A8C\u7684\
            \u8BC4\u4EF7\"\n}\n\n\u793A\u4F8B\u8F93\u51FA\uFF1A\n[{\"name\": \"\"\u5305\
            \u88C5\u8BBE\u8BA1\",\"attention\": \"\u4EBA\u6027\u5316,\u65F6\u5C1A\"\
            ,\"score\":1},\"name\": \"\"\u989C\u8272\u5438\u5F15\u529B\",\"attention\"\
            :\"\u7EA2\u8272\u4E0D\u5438\u5F15\u4EBA\",\"score\":-1},{\"name\": \"\u6574\
            \u4F53\u4F53\u9A8C\",\"attention\":\"\u4F53\u9A8C\u8FD8\u884C\",\"score\"\
            :1}]\n\n\u793A\u4F8B2\uFF1A\n\u8F93\u5165\uFF1A \"\u4EA7\u54C1\u7684\u5C3A\
            \u5BF8\u5B8C\u7F8E\u7B26\u5408\u6211\u7684\u9700\u6C42\uFF0C\u989C\u8272\
            \u4E5F\u597D\u770B\u3002\"\n\u9884\u8BBE\u7EF4\u5EA6\uFF1A\n{\n\"\u5C3A\
            \u5BF8\u9002\u914D\": \"\u5BF9\u4EA7\u54C1\u5C3A\u5BF8\u9002\u914D\u6027\
            \u7684\u8BC4\u4EF7\",\n}\n\u8F93\u51FA:\n[{\"name\":\"\u5C3A\u5BF8\u9002\
            \u914D\"\"attention\":\"\u5C3A\u5BF8\u5B8C\u7F8E\",\"score\":1}]\n\u6CE8\
            \u610F\uFF1A \u4EC5\u4E13\u6CE8\u4E8E\u9884\u8BBE\u7684\u7EF4\u5EA6\u3002\
            \u5FFD\u7565\u679A\u4E3E\u4E2D\u672A\u5217\u51FA\u7684\u4EFB\u4F55\u7EF4\
            \u5EA6\uFF0C\u5E76\u786E\u4FDD\u6240\u6709\u8BC4\u4F30\u90FD\u57FA\u4E8E\
            \u8F93\u5165\u6587\u672C\u4E2D\u63D0\u4F9B\u7684\u4E0A\u4E0B\u6587\u3002\
            \n\n# Init:\n\u8BF7\u8F93\u5165\u8BC4\u8BBA\uFF0C\u6211\u4F1A\u6309\u7167\
            Global\u6267\u884C\u540E\u8F93\u51FA\u5206\u6790\u7ED3\u679C\u3002\n"
        - id: c2a38da7-e24c-4fe3-bb1f-8d39c9efa19d
          role: user
          text: '{{#1719806031072.comments#}}'
        selected: false
        title: "\u5355\u6761\u6807\u7B7E\u9009\u62E9\u5668"
        type: llm
        variables: []
        vision:
          enabled: false
      height: 182
      id: '1719806881682'
      position:
        x: 911
        y: 388
      positionAbsolute:
        x: 911
        y: 388
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        code: "import json\nimport re\n\n\ndef preprocess_text(text):\n    # \u5C1D\
          \u8BD5\u53BB\u9664Markdown\u4EE3\u7801\u5757\u6807\u8BB0\uFF0C\u5982\u679C\
          \u5B58\u5728\n    cleaned_text = re.sub(r'```json\\n?', '', text)\n    cleaned_text\
          \ = re.sub(r'\\n?```', '', cleaned_text)\n    # \u53BB\u9664\u989D\u5916\
          \u7684\u7A7A\u767D\u5B57\u7B26\n    cleaned_text = re.sub(r'\\s+', ' ',\
          \ cleaned_text).strip()\n    return cleaned_text\n\ndef extract_json(cleaned_text):\n\
          \    # \u5C1D\u8BD5\u89E3\u6790\u6574\u4E2A\u6587\u672C\u4E3AJSON\n    try:\n\
          \        json_data = json.loads(cleaned_text)\n        return json_data\n\
          \    except json.JSONDecodeError:\n        # \u5982\u679C\u76F4\u63A5\u89E3\
          \u6790\u5931\u8D25\uFF0C\u5C1D\u8BD5\u67E5\u627E\u6240\u6709\u53EF\u80FD\
          \u7684JSON\u5BF9\u8C61\u6216\u6570\u7EC4\n        pattern = r'(\\[.*?\\\
          ])'\n        matches = re.findall(pattern, cleaned_text, re.DOTALL)\n  \
          \      return json.loads(matches[-1])\n\n\ndef main(keyword_dimension: str,\
          \ text: str) -> dict:\n    target_labels = []\n    predefined_labels = json.loads(keyword_dimension)\n\
          \    cleaned_text = preprocess_text(text)\n    print(f\"cleaned_text {cleaned_text}\"\
          )\n    tags_arr = extract_json(cleaned_text)\n    print(f\"json_data {tags_arr}\"\
          )\n    print(f\"type {type(tags_arr)}\")\n    for tag in tags_arr:\n   \
          \     if not isinstance(tag, dict):\n            raise ValueError(\"Each\
          \ tag in tags list is not a dict\")\n        if tag.get(\"name\") not in\
          \ predefined_labels:\n            continue\n        if tag.get(\"name\"\
          ) in [_.get(\"name\") for _ in target_labels]:\n            continue\n \
          \       target_labels.append({\n            \"name\": tag.get(\"name\"),\n\
          \            \"attention\": tag.get(\"attention\"),\n            \"score\"\
          : int(tag.get(\"score\"))\n        })\n\n    # \u8F6C\u6362\u6210\u591A\u7EF4\
          \n    return {\n        \"target_labels\": json.dumps([target_labels], ensure_ascii=False)\n\
          \    }"
        code_language: python3
        desc: ''
        outputs:
          target_labels:
            children: null
            type: string
        selected: false
        title: "\u89E3\u6790\u6A21\u578B\u7684json\u7ED3\u679C"
        type: code
        variables:
        - value_selector:
          - '1719806031072'
          - keyword_dimension
          variable: keyword_dimension
        - value_selector:
          - '1719806881682'
          - text
          variable: text
      height: 54
      id: '1719812840178'
      position:
        x: 1326
        y: 388
      positionAbsolute:
        x: 1326
        y: 388
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    - data:
        desc: ''
        outputs:
        - value_selector:
          - '1719812840178'
          - target_labels
          variable: content
        selected: false
        title: "\u5355\u6761\u9009\u62E9\u7ED3\u675F"
        type: end
      height: 90
      id: '1719813000907'
      position:
        x: 1627
        y: 388
      positionAbsolute:
        x: 1627
        y: 388
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 244
    viewport:
      x: -567
      y: 210.5
      zoom: 1

```